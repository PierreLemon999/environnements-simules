var B={trace:10,debug:20,info:30,warn:40,error:50,fatal:60},ie={};function U(r){return typeof r=="string"?B[r.toLowerCase()]:r}function W(r,t){return W=Object.setPrototypeOf||function(e,s){return e.__proto__=s,e},W(r,t)}function me(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function G(r,t,e){return G=me()?Reflect.construct:function(s,o,n){var u=[null];u.push.apply(u,o);var y=new(Function.bind.apply(s,u));return n&&W(y,n.prototype),y},G.apply(null,arguments)}function T(r){if(r==null)return r;if(Array.isArray(r))return r.slice();if(typeof r=="object"){var t={};return Object.keys(r).forEach(function(e){t[e]=r[e]}),t}return r}function J(r){return r===void 0?"undefined":r===null?"null":Array.isArray(r)?"[ "+r.map(function(t){return J(t)}).join(", ")+" ]":typeof r=="object"?JSON.stringify(r):typeof r=="function"?"[Function: "+r.name+"]":typeof r=="boolean"||typeof r=="number"?r:"'"+r.toString()+"'"}function A(r){if(typeof r!="string"){for(var t=new Array(arguments.length),e=0;e<arguments.length;e++)t[e]=J(arguments[e]);return t.join(" ")}for(var s=/%[sdj%]/g,o=1,n=arguments,u=n.length,y=String(r).replace(s,function(v){if(v==="%%")return"%";if(o>=u)return v;switch(v){case"%s":return String(n[o++]);case"%d":return Number(n[o++]);case"%j":try{return JSON.stringify(n[o++])}catch{return"[Circular]"}default:return v}}),h=n[o];o<u;h=n[++o])y+=h===null||typeof h!="object"?" "+h:" "+J(h);return y}function ve(r,t){var e=r.split(`
`);e[0]&&e[0].indexOf("call-stack-error")>=0&&e.shift();var s=e[t],o=null;if(s){var n=/^\s*(at|.*@)\s*(.+)?$/.exec(s);o=Array.isArray(n)&&n[2]?n[2]:s}return o}Object.keys(B).forEach(function(r){ie[B[r]]=r});var Y={};function Q(r,t){if(t){if(Y[t])return;Y[t]=!0}console.error(r+`
`)}function de(r){return Y[r]}function ye(){var r=[];return function(t,e){return e&&typeof e=="object"?r.indexOf(e)!==-1?"[Circular]":(r.push(e),e):e}}var ge=(function(){function r(){}return r.prototype.write=function(t){t.level<30?console.log(t):t.level<40?console.info(t):t.level<50?console.warn(t):console.error(t),t.err&&t.err.stack&&console.error(t.err.stack),t.obj&&console.log(t.obj)},r})(),K=(function(){function r(e,s,o){var n,u,y,h,v=this;if(!(this instanceof r))return new r(e,s);if(s!==void 0&&(n=e,e=s,!(n instanceof r)))throw new TypeError("invalid Logger creation: do not pass a second arg");if(!e)throw new TypeError("options (object) is required");if(n){if(e.name)throw new TypeError("invalid options.name: child cannot set logger name")}else if(!e.name)throw new TypeError("options.name (string) is required");if(e.stream&&e.streams)throw new TypeError('cannot mix "streams" and "stream" options');if(e.streams&&!Array.isArray(e.streams))throw new TypeError("invalid options.streams: must be an array");if(e.serializers&&(typeof e.serializers!="object"||Array.isArray(e.serializers)))throw new TypeError("invalid options.serializers: must be an object");if(n&&o){this._level=n._level,this.streams=n.streams,this.serializers=n.serializers,this.src=n.src,u=this.fields={};var g=Object.keys(n.fields);for(h=0;h<g.length;h++)u[y=g[h]]=n.fields[y];var w=Object.keys(e);for(h=0;h<w.length;h++)u[y=w[h]]=e[y]}else{if(n){for(this._level=n._level,this.streams=[],h=0;h<n.streams.length;h++){var x=T(n.streams[h]);this.streams.push(x)}this.serializers=T(n.serializers),this.src=n.src,this.fields=T(n.fields),e.level&&this.level(e.level)}else this._level=Number.POSITIVE_INFINITY,this.streams=[],this.serializers=null,this.src=!1,this.fields={};e.stream?this.addStream({type:"stream",stream:e.stream,level:e.level}):e.streams?e.streams.forEach(function(I){v.addStream(I,e.level)}):n&&e.level?this.level(e.level):n||this.addStream({type:"raw",stream:new ge,level:e.level}),e.serializers&&this.addSerializers(e.serializers),e.src&&(this.src=!0),delete(u=T(e)).stream,delete u.level,delete u.streams,delete u.serializers,delete u.src,this.serializers&&this._applySerializers(u),Object.keys(u).forEach(function(I){v.fields[I]=u[I]})}}var t=r.prototype;return t.addStream=function(e,s){s===void 0&&(s=30),(e=T(e)).type="raw",e.level=U(e.level||s),e.level<this._level&&(this._level=e.level),this.streams.push(e),delete this.haveNonRawStreams},t.addSerializers=function(e){var s=this;this.serializers||(this.serializers={}),Object.keys(e).forEach(function(o){var n=e[o];if(typeof n!="function")throw new TypeError(A('invalid serializer for "%s" field: must be a function',o));s.serializers[o]=n})},t.child=function(e,s){return new this.constructor(this,e||{},s)},t.level=function(e){if(e===void 0)return this._level;for(var s=U(e),o=this.streams.length,n=0;n<o;n++)this.streams[n].level=s;this._level=s},t.levels=function(e,s){if(e===void 0)return this.streams.map(function(v){return v.level});var o;if(typeof e=="number"){if((o=this.streams[e])===void 0)throw new Error("invalid stream index: "+e)}else{for(var n=this.streams.length,u=0;u<n;u++){var y=this.streams[u];if(y.name===e){o=y;break}}if(!o)throw new Error(A('no stream with name "%s"',e))}if(s===void 0)return o.level;var h=U(s);o.level=h,h<this._level&&(this._level=h)},t._applySerializers=function(e,s){var o=this;Object.keys(this.serializers).forEach(function(n){if(!(e[n]===void 0||s&&s[n]))try{e[n]=o.serializers[n](e[n])}catch(u){Q(A(`bunyan: ERROR: Exception thrown from the "%s" Bunyan serializer. This should never happen. This is a bugin that serializer function.
%s`,n,u.stack||u)),e[n]=A('(Error in Bunyan log "%s" serializer broke field. See stderr for details.)',n)}})},t._emit=function(e,s){var o,n;if(this.haveNonRawStreams===void 0){for(this.haveNonRawStreams=!1,o=0;o<this.streams.length;o++)if(!this.streams[o].raw){this.haveNonRawStreams=!0;break}}if(s||this.haveNonRawStreams)try{n=JSON.stringify(e,ye())+`
`}catch(v){var u=v.stack.split(/\n/g,2).join(`
`);Q('bunyan: ERROR: Exception in `JSON.stringify(rec)`. You can install the "safe-json-stringify" module to have Bunyan fallback to safer stringification. Record:\n'+(function(g,w){return w||(w="    "),w+g.split(/\r?\n/g).join(`
`+w)})(A(`%s
%s`,e,v.stack)),u),n=A(`(Exception in JSON.stringify(rec): %j. See stderr for details.)
`,v.message)}if(s)return n;var y=e.level;for(o=0;o<this.streams.length;o++){var h=this.streams[o];h.level<=y&&h.stream.write(e)}return n},r})();function $(r){return function(){var t=this;function e(u){var y;u[0]instanceof Error?(s={err:t.serializers&&t.serializers.err?t.serializers.err(u[0]):le.err(u[0])},y={err:!0},o=u.length===1?[s.err.message]:Array.prototype.slice.call(u,1)):typeof u[0]!="object"&&u[0]!==null||Array.isArray(u[0])?(s=null,o=Array.prototype.slice.call(u)):(s=u[0],o=u.length===1&&s.err&&s.err instanceof Error?[s.err.message]:Array.prototype.slice.call(u,1));var h=T(t.fields);h.level=r;var v=s?T(s):null;if(v&&(t.serializers&&t._applySerializers(v,y),Object.keys(v).forEach(function(w){h[w]=v[w]})),h.levelName=ie[r],h.msg=o.length?A.apply(t,o):"",h.time||(h.time=new Date),t.src&&!h.src)try{throw new Error("call-stack-error")}catch(w){var g=w.stack?ve(w.stack,2):"";g||de("src")||Q("Unable to determine src line info","src"),h.src=g||""}return h.v=1,h}var s=null,o=arguments,n=null;if(arguments.length===0)return this._level<=r;this._level>r||(n=e(o),this._emit(n))}}function oe(r){var t=r.stack||r.toString();if(r.cause&&typeof r.cause=="function"){var e=r.cause();e&&(t+=`
Caused by: `+oe(e))}return t}K.prototype.trace=$(10),K.prototype.debug=$(20),K.prototype.info=$(30),K.prototype.warn=$(40),K.prototype.error=$(50),K.prototype.fatal=$(60);var le={err:function(r){return r&&r.stack?{message:r.message,name:r.name,stack:oe(r),code:r.code,signal:r.signal}:r}};function pe(){return G(K,[].slice.call(arguments))}var we=10,X=20,be=30,_e=40,Ee=50,ee=60,te={trace:10,debug:20,info:30,warn:40,error:50,fatal:60},ce={};Object.keys(te).forEach(function(r){ce[te[r]]=r});const re={levels:{trace:"color: DeepPink",debug:"color: GoldenRod",info:"color: DarkTurquoise",warn:"color: Purple",error:"color: Crimson",fatal:"color: Black"},def:"color: DimGray",msg:"color: SteelBlue",extra:"color: Tomato",src:"color: DimGray; font-style: italic; font-size: 0.9em"};class Ie{constructor({logByLevel:t=!1,css:e=re}={}){this.logByLevel=t,this.css=e}write(t){const{level:e,childName:s,name:o,src:n,time:u,msg:y,obj:h,err:v,v:g,levelName:w,...x}=t;let I,L;const i=this.css.def,l=this.css.msg,a=this.css.src,c=this.css.extra,f=s!=null?o+"/"+s:o;let d=ce[e];const _=(Array(6-d.length).join(" ")+d).toUpperCase();this.logByLevel?(e===we||e===X?d="log":e===ee&&(d="error"),L=console[d]??console.log):L=console.log,e<X?I=this.css.levels.trace:e<be?I=this.css.levels.debug:e<_e?I=this.css.levels.info:e<Ee?I=this.css.levels.warn:e<ee?I=this.css.levels.error:I=this.css.levels.fatal;const p=(E,b)=>Array(b+1-(E+"").length).join("0")+E,M=x.length===0?"":Object.keys(x).reduce((E,b)=>E+`
%c%s: %c%s`,"")+`
`,m=[];m.push(`[LemonLearning] [%s:%s:%s:%s] %c%s%c: %s: %c%s ${M} ${n!=null&&n.length>0?"%c%s":""}`),m.push(p(u.getHours(),2)),m.push(p(u.getMinutes(),2)),m.push(p(u.getSeconds(),2)),m.push(p(u.getMilliseconds(),4)),m.push(I),m.push(_),m.push(i),m.push(f),m.push(l),m.push(y);for(const E in x)m.push(i),m.push(E),m.push(c),m.push(JSON.stringify(x[E]));n!=null&&n.length>0&&(m.push(a),m.push(n)),h!=null&&(m.push(`
`),m.push(h)),Se()?(v?.message!=null&&(m.push(`
`),m.push(v.message)),v?.stack!=null&&v.stack!==""&&(m.push(`
`),m.push(v.stack))):v?.stack!=null&&v.stack!==""?(m.push(`
`),m.push(v.stack)):v?.message!=null&&(m.push(`
`),m.push(v.message)),L.apply(console,m)}static getDefaultCss(){return re}}function Se(){return navigator.userAgent.includes("Firefox")}var se=Object.prototype.hasOwnProperty;function H(r,t){var e,s;if(r===t)return!0;if(r&&t&&(e=r.constructor)===t.constructor){if(e===Date)return r.getTime()===t.getTime();if(e===RegExp)return r.toString()===t.toString();if(e===Array){if((s=r.length)===t.length)for(;s--&&H(r[s],t[s]););return s===-1}if(!e||typeof r=="object"){s=0;for(e in r)if(se.call(r,e)&&++s&&!se.call(t,e)||!(e in t)||!H(r[e],t[e]))return!1;return Object.keys(t).length===s}}return r!==r&&t!==t}const ke=new Error("request for lock canceled");var Me=function(r,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function y(g){try{v(s.next(g))}catch(w){u(w)}}function h(g){try{v(s.throw(g))}catch(w){u(w)}}function v(g){g.done?n(g.value):o(g.value).then(y,h)}v((s=s.apply(r,t||[])).next())})};class je{constructor(t,e=ke){this._value=t,this._cancelError=e,this._queue=[],this._weightedWaiters=[]}acquire(t=1,e=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((s,o)=>{const n={resolve:s,reject:o,weight:t,priority:e},u=ue(this._queue,y=>e<=y.priority);u===-1&&t<=this._value?this._dispatchItem(n):this._queue.splice(u+1,0,n)})}runExclusive(t){return Me(this,arguments,void 0,function*(e,s=1,o=0){const[n,u]=yield this.acquire(s,o);try{return yield e(n)}finally{u()}})}waitForUnlock(t=1,e=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,e)?Promise.resolve():new Promise(s=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),xe(this._weightedWaiters[t-1],{resolve:s,priority:e})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const e=this._value;this._value-=t.weight,t.resolve([e,this._newReleaser(t.weight)])}_newReleaser(t){let e=!1;return()=>{e||(e=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){const e=this._weightedWaiters[t-1];e&&(e.forEach(s=>s.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let e=this._value;e>0;e--){const s=this._weightedWaiters[e-1];if(!s)continue;const o=s.findIndex(n=>n.priority<=t);(o===-1?s:s.splice(0,o)).forEach((n=>n.resolve()))}}}_couldLockImmediately(t,e){return(this._queue.length===0||this._queue[0].priority<e)&&t<=this._value}}function xe(r,t){const e=ue(r,s=>t.priority<=s.priority);r.splice(e+1,0,t)}function ue(r,t){for(let e=r.length-1;e>=0;e--)if(t(r[e]))return e;return-1}var Oe=function(r,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function y(g){try{v(s.next(g))}catch(w){u(w)}}function h(g){try{v(s.throw(g))}catch(w){u(w)}}function v(g){g.done?n(g.value):o(g.value).then(y,h)}v((s=s.apply(r,t||[])).next())})};class Ae{constructor(t){this._semaphore=new je(1,t)}acquire(){return Oe(this,arguments,void 0,function*(t=0){const[,e]=yield this._semaphore.acquire(1,t);return e})}runExclusive(t,e=0){return this._semaphore.runExclusive(()=>t(),1,e)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const F=globalThis.browser?.runtime?.id==null?globalThis.chrome:globalThis.browser,k=Ke();function Ke(){const r={local:C("local"),session:C("session"),sync:C("sync"),managed:C("managed")},t=i=>{const l=r[i];if(l==null){const a=Object.keys(r).join(", ");throw Error(`Invalid area "${i}". Options: ${a}`)}return l},e=i=>{const l=i.indexOf(":"),a=i.substring(0,l),c=i.substring(l+1);if(c==null)throw Error(`Storage key should be in the form of "area:key", but received "${i}"`);return{driverArea:a,driverKey:c,driver:t(a)}},s=i=>i+"$",o=(i,l)=>{const a={...i};return Object.entries(l).forEach(([c,f])=>{f==null?delete a[c]:a[c]=f}),a},n=(i,l)=>i??l??null,u=i=>typeof i=="object"&&!Array.isArray(i)?i:{},y=async(i,l,a)=>{const c=await i.getItem(l);return n(c,a?.fallback??a?.defaultValue)},h=async(i,l)=>{const a=s(l),c=await i.getItem(a);return u(c)},v=async(i,l,a)=>{await i.setItem(l,a??null)},g=async(i,l,a)=>{const c=s(l),f=u(await i.getItem(c));await i.setItem(c,o(f,a))},w=async(i,l,a)=>{if(await i.removeItem(l),a?.removeMeta){const c=s(l);await i.removeItem(c)}},x=async(i,l,a)=>{const c=s(l);if(a==null)await i.removeItem(c);else{const f=u(await i.getItem(c));[a].flat().forEach(d=>delete f[d]),await i.setItem(c,f)}},I=(i,l,a)=>i.watch(l,a);return{getItem:async(i,l)=>{const{driver:a,driverKey:c}=e(i);return await y(a,c,l)},getItems:async i=>{const l=new Map,a=new Map,c=[];i.forEach(d=>{let _,p;typeof d=="string"?_=d:"getValue"in d?(_=d.key,p={fallback:d.fallback}):(_=d.key,p=d.options),c.push(_);const{driverArea:M,driverKey:m}=e(_),E=l.get(M)??[];l.set(M,E.concat(m)),a.set(_,p)});const f=new Map;return await Promise.all(Array.from(l.entries()).map(async([d,_])=>{(await r[d].getItems(_)).forEach(M=>{const m=`${d}:${M.key}`,E=a.get(m),b=n(M.value,E?.fallback??E?.defaultValue);f.set(m,b)})})),c.map(d=>({key:d,value:f.get(d)}))},getMeta:async i=>{const{driver:l,driverKey:a}=e(i);return await h(l,a)},getMetas:async i=>{const l=i.map(f=>{const d=typeof f=="string"?f:f.key,{driverArea:_,driverKey:p}=e(d);return{key:d,driverArea:_,driverKey:p,driverMetaKey:s(p)}}),a=l.reduce((f,d)=>(f[d.driverArea]??=[],f[d.driverArea].push(d),f),{}),c={};return await Promise.all(Object.entries(a).map(async([f,d])=>{const _=await F.storage[f].get(d.map(p=>p.driverMetaKey));d.forEach(p=>{c[p.key]=_[p.driverMetaKey]??{}})})),l.map(f=>({key:f.key,meta:c[f.key]}))},setItem:async(i,l)=>{const{driver:a,driverKey:c}=e(i);await v(a,c,l)},setItems:async i=>{const l={};i.forEach(a=>{const{driverArea:c,driverKey:f}=e("key"in a?a.key:a.item.key);l[c]??=[],l[c].push({key:f,value:a.value})}),await Promise.all(Object.entries(l).map(async([a,c])=>{await t(a).setItems(c)}))},setMeta:async(i,l)=>{const{driver:a,driverKey:c}=e(i);await g(a,c,l)},setMetas:async i=>{const l={};i.forEach(a=>{const{driverArea:c,driverKey:f}=e("key"in a?a.key:a.item.key);l[c]??=[],l[c].push({key:f,properties:a.meta})}),await Promise.all(Object.entries(l).map(async([a,c])=>{const f=t(a),d=c.map(({key:m})=>s(m));console.log(a,d);const _=await f.getItems(d),p=Object.fromEntries(_.map(({key:m,value:E})=>[m,u(E)])),M=c.map(({key:m,properties:E})=>{const b=s(m);return{key:b,value:o(p[b]??{},E)}});await f.setItems(M)}))},removeItem:async(i,l)=>{const{driver:a,driverKey:c}=e(i);await w(a,c,l)},removeItems:async i=>{const l={};i.forEach(a=>{let c,f;typeof a=="string"?c=a:"getValue"in a?c=a.key:"item"in a?(c=a.item.key,f=a.options):(c=a.key,f=a.options);const{driverArea:d,driverKey:_}=e(c);l[d]??=[],l[d].push(_),f?.removeMeta&&l[d].push(s(_))}),await Promise.all(Object.entries(l).map(async([a,c])=>{await t(a).removeItems(c)}))},clear:async i=>{await t(i).clear()},removeMeta:async(i,l)=>{const{driver:a,driverKey:c}=e(i);await x(a,c,l)},snapshot:async(i,l)=>{const c=await t(i).snapshot();return l?.excludeKeys?.forEach(f=>{delete c[f],delete c[s(f)]}),c},restoreSnapshot:async(i,l)=>{await t(i).restoreSnapshot(l)},watch:(i,l)=>{const{driver:a,driverKey:c}=e(i);return I(a,c,l)},unwatch(){Object.values(r).forEach(i=>{i.unwatch()})},defineItem:(i,l)=>{const{driver:a,driverKey:c}=e(i),{version:f=1,migrations:d={}}=l??{};if(f<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const _=async()=>{const b=s(c),[{value:O},{value:q}]=await a.getItems([c,b]);if(O==null)return;const z=q?.v??1;if(z>f)throw Error(`Version downgrade detected (v${z} -> v${f}) for "${i}"`);if(z===f)return;console.debug(`[@wxt-dev/storage] Running storage migration for ${i}: v${z} -> v${f}`);const he=Array.from({length:f-z},(P,D)=>z+D+1);let V=O;for(const P of he)try{V=await d?.[P]?.(V)??V}catch(D){throw new Te(i,P,{cause:D})}await a.setItems([{key:c,value:V},{key:b,value:{...q,v:f}}]),console.debug(`[@wxt-dev/storage] Storage migration completed for ${i} v${f}`,{migratedValue:V})},p=l?.migrations==null?Promise.resolve():_().catch(b=>{console.error(`[@wxt-dev/storage] Migration failed for ${i}`,b)}),M=new Ae,m=()=>l?.fallback??l?.defaultValue??null,E=()=>M.runExclusive(async()=>{const b=await a.getItem(c);if(b!=null||l?.init==null)return b;const O=await l.init();return await a.setItem(c,O),O});return p.then(E),{key:i,get defaultValue(){return m()},get fallback(){return m()},getValue:async()=>(await p,l?.init?await E():await y(a,c,l)),getMeta:async()=>(await p,await h(a,c)),setValue:async b=>(await p,await v(a,c,b)),setMeta:async b=>(await p,await g(a,c,b)),removeValue:async b=>(await p,await w(a,c,b)),removeMeta:async b=>(await p,await x(a,c,b)),watch:b=>I(a,c,(O,q)=>b(O??m(),q??m())),migrate:_}}}}function C(r){const t=()=>{if(F.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if(F.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const s=F.storage[r];if(s==null)throw Error(`"browser.storage.${r}" is undefined`);return s},e=new Set;return{getItem:async s=>(await t().get(s))[s],getItems:async s=>{const o=await t().get(s);return s.map(n=>({key:n,value:o[n]??null}))},setItem:async(s,o)=>{o==null?await t().remove(s):await t().set({[s]:o})},setItems:async s=>{const o=s.reduce((n,{key:u,value:y})=>(n[u]=y,n),{});await t().set(o)},removeItem:async s=>{await t().remove(s)},removeItems:async s=>{await t().remove(s)},clear:async()=>{await t().clear()},snapshot:async()=>await t().get(),restoreSnapshot:async s=>{await t().set(s)},watch(s,o){const n=u=>{const y=u[s];y!=null&&(H(y.newValue,y.oldValue)||o(y.newValue??null,y.oldValue??null))};return t().onChanged.addListener(n),e.add(n),()=>{t().onChanged.removeListener(n),e.delete(n)}},unwatch(){e.forEach(s=>{t().onChanged.removeListener(s)}),e.clear()}}}class Te extends Error{constructor(t,e,s){super(`v${e} migration failed for "${t}"`,s),this.key=t,this.version=e}}async function ze(r){return k.getItem(await j(r))}async function $e(r){const t=await Promise.all(r.map(async e=>j(e)));return k.getItems(t).then(e=>e.map((s,o)=>({key:r[o],value:s.value})))}async function Re(r){return k.getMeta(await j(r))}async function Ne(r,t){return k.setItem(await j(r),t)}async function Ve(r){return k.setItems(await Promise.all(r.map(async({key:t,value:e})=>({key:await j(t),value:e}))))}async function Le(r){return k.removeItem(await j(r))}async function qe(r){return k.removeItems(await Promise.all(r.map(async t=>j(t))))}async function Ce(r,t){return k.removeMeta(await j(r),t)}async function Fe(r,t){return k.setMeta(await j(r),t)}function Pe(r,t){let e,s=!1;return(async()=>{const n=await j(r);s||(e=k.watch(n,t))})(),()=>{s=!0,e?.()}}async function De(r,t){return k.defineItem(await j(r),t)}async function Ue(){let r;return r===void 0&&(r=await k.getItem("sync:test").then(()=>!0).catch(t=>{if(t.message==="Please set webextensions.storage.sync.enabled to true in about:config")return!1;throw t})),r}async function j(r){return await Ue()?r:r.replace("sync:","local:")}const ne={...k,getItem:ze,setItem:Ne,getItems:$e,getMeta:Re,setItems:Ve,removeItem:Le,removeItems:qe,removeMeta:Ce,setMeta:Fe,watch:Pe,defineItem:De},ae="LemonDebuggerLevel";var fe=(r=>(r.FATAL="fatal",r.ERROR="error",r.WARN="warn",r.INFO="info",r.DEBUG="debug",r.TRACE="trace",r.SILENT="silent",r))(fe||{});let Z=null;const S=pe({name:"default",streams:[{level:"trace",stream:new Ie({logByLevel:!0})}],serializers:le,src:!0});S.level("silent");const R={trace:N,debug:N,info:N,warn:N,error:N,fatal:N};function N(){console.warn("[LemonLearning] The logger should be setup before it can be used")}async function Be(){if(R.trace=S.trace.bind(S),R.debug=S.debug.bind(S),R.info=S.info.bind(S),R.warn=S.warn.bind(S),R.error=S.error.bind(S),R.fatal=S.fatal.bind(S),Z===null){console.error("[LemonLearning] The logger levelStorage should never be null at that point. Cannot set the logger level");return}const r=await Z.get();r!==null&&S.level(r)}function Je(){We(),Be()}function We(){Z={get:async()=>{const r=await ne.getItem(`local:${ae}`);return typeof r=="string"&&Ge(r)?r:null},set:async r=>{await ne.setItem(`local:${ae}`,r)}}}function Ge(r){return Object.values(fe).includes(r)}function Ye(){}export{fe as L,Ye as a,Z as b,ne as c,Je as i,R as l,We as s};
