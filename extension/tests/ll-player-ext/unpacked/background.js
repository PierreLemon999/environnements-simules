import{i as bt,c as A,l as w,a as xt}from"./chunks/_virtual_wxt-plugins-CypXSbNT.js";let $e;const kt=()=>{$e=!0},nt=()=>{if($e===void 0)throw new Error("You must call 'initFromContentScript' or 'initFromPageScript' before calling 'isWebExtension'. This must be done in the entry file");return $e};let Ue;function Tt(r){Ue=r}function Et(){if(Ue===void 0)throw new Error("You must call 'setBackground' before calling 'isBackgroundScript'. This must be done in the entry file");return Ue}bt();kt();Tt(!0);function It(r){return r==null||typeof r=="function"?{main:r}:r}const st=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome,I=st;async function ze(r,e={}){if(Et()){const t=await fetch(r,{method:"GET",headers:e});return{body:await t.json(),status:t.status,statusText:t.statusText,headers:Object.fromEntries(t.headers.entries())}}return await I.runtime.sendMessage({action:"BACKGROUND_FETCH_V2",data:{url:r,options:{method:"GET",headers:e}}})}let Te=null;async function St(){try{const[r,e,t]=await Promise.all([A.getItem("managed:domain"),A.getItem("managed:stats_url"),A.getItem("managed:analytics_url")]);if(typeof r=="string"){Rt(r,e,t);return}}catch(r){w.error(r,"Error getting managed storage, setting up default env variables")}Ct()}function Ct(){const r="lemonlearning.com";Te={PLAYER_URL:`https://player.${r}`,EDITOR_URL:`https://editor.${r}`,ADMIN_URL:`https://admin.${r}`,STATIC_URL:`https://static.${r}`,LEMONSTATS_URL:"https://stats.lemonlearning.com",ANALYSE_URL:"https://ingress-analyze.production.main-eu-west-3.aws.lemonlearning.tech",IFRAME_BRIDGE_URL:`http://static.${r}`,API_URL:`https://api.${r}`,LEMON_AI_URL:`https://ai.${r}`}}function Rt(r,e,t){if(typeof e!="string")throw new Error("Environment not properly configured: stats URL override is required.");const n=typeof t=="string"?t:null;w.info(`Environment overrides detected. Using Domain: "${r}"; Stats URL: "${e}"; Analytics URL: ${n}"}.`),Te={PLAYER_URL:`https://player.${r}`,EDITOR_URL:`https://editor.${r}`,ADMIN_URL:`https://admin.${r}`,STATIC_URL:`https://static.${r}`,LEMONSTATS_URL:e,ANALYSE_URL:n,IFRAME_BRIDGE_URL:`http://static.${r}`,API_URL:`https://api.${r}`,LEMON_AI_URL:`https://ai.${r}`}}function Le(r){if(Te==null)throw new Error("Environment variables have not been set up. Please call setupExtensionEnv or setupDirectEnv first.");return Te[r]}const Ot=3600*1e3;async function at(){w.debug("Getting the configuration");const r=await A.getItem("local:configurationCache");let e,t;try{if(r!=null&&typeof r=="string"){const a=JSON.parse(r);t=a.timestamp,e=a.configuration}}catch(a){w.debug(a,{serialized:r},"A configuration was found in the cache, but an error occurred while parsing it, ignoring the cache")}const n=t==null||Date.now()-t>Ot;if(e!==void 0&&!n)return w.debug({configuration:e,timestamp:t},"Using the cached configuration"),e;e!==void 0&&n&&w.debug({configuration:e,timestamp:t},"A configuration was found in the cache, but it is expired, ignoring it");const s=await At();return A.setItem("local:configurationCache",JSON.stringify({configuration:s,timestamp:Date.now()})),s}async function Nt(){try{const r=await A.getItem("managed:configKey");return typeof r=="string"?r:null}catch(r){return w.warn(r,"An error occurred while trying to get the configKey from the cache, returning 'null' as a fallback"),null}}async function At(){const r=await Nt();if(r==null)return w.debug("The extension is not managed by a Group Policy, returning 'null' for the configuration"),null;w.debug({configKey:r},"A configKey was found, fetching the configuration from the API");const e=new URLSearchParams({key:r});try{const{body:{success:t,configuration:n}}=await ze(`${Le("PLAYER_URL")}/configuration?${e.toString()}`,{"Content-Type":"application/x-www-form-urlencoded"});if(!t)throw new Error(`An error occurred while fetching the configuration from the API with configKey: "${r}"`);return n}catch(t){throw new Error(`Error while retrieving configuration from API: ${t.message}`)}}async function Lt(){return at().then(r=>r!=null?r.company_key:null).catch(r=>(w.warn(r,"An error occurred while trying to get the company key, returning 'null' as a fallback"),null))}let Pe;async function Mt(){if(Pe===void 0){const r=await at();Pe=r!=null&&"player_disabled"in r&&r.player_disabled===!0}return Pe}const Zt="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Pt=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r));for(;r--;)e+=Zt[t[r]&63];return e};class it extends Error{constructor(){super("Access token invalid")}}const jt=$t();function $t(){return{listeners:new Map,on(r,e){return w.trace(`EventsHandler: on ${r}`),this.listeners.has(r)||this.listeners.set(r,[]),this.listeners.get(r)?.push(e),this},trigger(r,...e){w.trace(`EventsHandler: trigger ${r}`),this.listeners.get(r)?.forEach(n=>{n(...e)})},removeListener(r,e){w.trace(`EventsHandler: removeListener ${r}`);const t=this.listeners.get(r);this.listeners.set(r,t?.filter(n=>n!==e)??[])}}}class Ut{constructor(){this.blockedOrigins=new Set([/walkme\.cloud\.sap/i])}isAllowed(e){return!this.isOriginBlocked(e)}isOriginBlocked(e){return e.origin?Array.from(this.blockedOrigins).some(t=>t.test(e.origin)):!1}}const Ye=class Ye{static addFilteredWindowListener(e=globalThis.window,t,n,s){const a=i=>{this.messageEventFilter.isAllowed(i)&&t(i)};return e.addEventListener("message",a,s),()=>{e.removeEventListener("message",a,s)}}};Ye.messageEventFilter=new Ut;let De=Ye;jt.on("set-player",function(r){"namespace"in r&&typeof r.namespace=="string"&&r.namespace});const We=()=>`${Le("STATIC_URL")}/storage.html`,Dt="ORIGIN_LEMON_FRAME_STORAGE",Ft="RETURN_READ",ke=Pt(),Je=new Set;function Vt(r){const e=document.createElement("iframe");e.style.setProperty("display","none"),e.setAttribute("id",ke),e.setAttribute("src",We()),e.addEventListener("load",r,{once:!0}),document.body.appendChild(e)}async function ot(){const r=document.getElementById(ke),e=(n,s)=>(Je.add(ke),n.target instanceof HTMLIFrameElement?s(n.target):s(null)),t=n=>{Je.has(ke)&&n(r),r?.addEventListener("load",s=>e(s,n),{once:!0})};return new Promise(n=>{r!==null?t(n):Vt(s=>e(s,n))})}function Ht(r){try{return JSON.parse(r.data)}catch{return null}}async function Bt(r){const t=(await ot())?.contentWindow,n=JSON.stringify({action:"read",key:r});return new Promise(s=>{const a=i=>{const o=Ht(i);o?.origin===Dt&&o?.action===Ft&&o?.key===r&&(window.removeEventListener("message",a),s(o.value))};De.addFilteredWindowListener(window,a,"IframeStorage.ts returnListener"),t?.postMessage(n,We())})}async function zt(r){await ot().then(e=>{const t=e?.contentWindow,n=JSON.stringify({action:"remove",key:r});t?.postMessage(n,We())})}const ct="lemonlearning-identity",Wt=async(r=null)=>{if(nt())try{const e=await A.getItem("sync:access_token");return e==null||typeof e!="string"?(w.debug("No access token found, stopping LL features"),null):e}catch(e){return w.error(e,"Error while reading access token from storage"),null}return await Bt(r??ct).then(e=>JSON.parse(e)).then(e=>e?.access_token??null)},Gt=async(r=null)=>{if(w.debug("Clearing cached access token from storage"),nt()){await A.removeItem("sync:access_token");return}await zt(r??ct)};async function Yt(r){const e=await ze(`${Le("PLAYER_URL")}/api/hosts`,{Accept:"application/json",Authorization:`Bearer ${r}`});if(e.status!==200)throw e.status===401?new it:new Error(`Error (${e.status}) while fetching user hosts`);return e.body.hosts.map(t=>({name:t.name,exclude:t.exclude}))}async function Jt(r){const e=new URLSearchParams({company:r}),t=await ze(`${Le("PLAYER_URL")}/company-hosts?${e.toString()}`,{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"});if(t.status!==200)throw new Error(`Error (${t.status}) while fetching company hosts`);return t.body.hosts.map(n=>({name:n.name,exclude:n.exclude}))}const qt=3600*1e3;async function Kt(){const r=await Qt();if(r===null)return w.debug("Hosts cache is empty"),null;const e=JSON.parse(r);return Xt(e)?(w.warn(e,"Hosts cache is expired"),null):e.hosts}async function Qt(){const r=await A.getItem("sync:hostsCache");if(r===null)return null;if(typeof r!="string")throw new Error(`Invalid format of hosts cache: Expected string and found "${typeof r}". Stringified Value = (${JSON.stringify(r)})`);return r}function Xt(r){return Date.now()-r.timestamp>qt}async function qe(r){try{await er(r)}catch(e){w.warn(e,"An error occurred while trying to store the hosts list in the cache")}}async function er(r){await A.setItem("sync:hostsCache",JSON.stringify({hosts:r,timestamp:Date.now()}))}async function tr(){w.debug("Getting the list of hosts on which the player might be displayed");try{const t=await Kt();if(t!==null)return t}catch(t){w.warn(t,"An error occurred while trying to get the hosts list from the cache, fetching the hosts list")}const r=await Wt();if(r!==null)try{w.info("fetchHostsList: Found a cached user token. Attempting to fetch user hosts");const t=await Yt(r);return await qe(t),t}catch(t){w.warn(t,"fetchHostsList: Fetching user hosts failed. Trying to fetch company hosts."),t instanceof it&&await Gt()}const e=await Lt();if(e!==null)try{w.info({companyKey:e},"fetchHostsList: Attempting to fetch company hosts");const t=await Jt(e);return await qe(t),t}catch{return w.warn("Error while fetching company hosts. Hiding the player on all hosts."),[]}return w.info("fetchHostsList : Player has no configuration key, allowing player to be displayed on all hosts"),"*"}class rr{constructor(e){const{currentHost:t,hosts:n,ignorePathOnIncluded:s}=e;this.currentHost=this.removeProtocol(t),this.hosts=n==="*"?"*":n.map(a=>({...a,name:this.removeProtocol(a.name)})),this.ignorePathOnIncluded=s??!1}isRespected(){if(this.hosts==="*")return!0;const e=this.hosts.find(s=>this.currentHost.includes(s.name)&&s.exclude);if(e!=null)return w.warn(`The current host match the host ${e.name} which is excluded`),!1;if(this.hosts.some(s=>{const a=this.ignorePathOnIncluded?s.name.split("/")[0]:s.name;return this.currentHost.includes(a)}))return!0;const t=this.hosts.length===0;let n="";return t?n=`
                  The included hosts' list is empty. It may mean one of the following things :
                    1. Your connected user is not active (doesn't have a license)
                    2. The hosts list is still in cache and has not been updated yet (try forcing logout and login again)
                    3. You have no tools configured in your project (the one associated to your connected user)
                  `:n=`The current host "${this.currentHost}" does not match one of the included ones. Included ones are : ${this.hosts.map(s=>s.name).join(", ")}`,w.warn(n),!1}removeProtocol(e){return e.replace(/^https?:\/\//,"")}}const P=st;var b;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},r.getValidEnumValues=s=>{const a=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return r.objectValues(i)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},r.find=(s,a)=>{for(const i of s)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=n,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(b||(b={}));var Fe;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Fe||(Fe={}));const f=b.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),V=r=>{switch(typeof r){case"undefined":return f.undefined;case"string":return f.string;case"number":return isNaN(r)?f.nan:f.number;case"boolean":return f.boolean;case"function":return f.function;case"bigint":return f.bigint;case"symbol":return f.symbol;case"object":return Array.isArray(r)?f.array:r===null?f.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?f.promise:typeof Map<"u"&&r instanceof Map?f.map:typeof Set<"u"&&r instanceof Set?f.set:typeof Date<"u"&&r instanceof Date?f.date:f.object;default:return f.unknown}},d=b.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),nr=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class N extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let o=n,l=0;for(;l<i.path.length;){const u=i.path[l];l===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(i))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),n}static assert(e){if(!(e instanceof N))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,b.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}N.create=r=>new N(r);const ee=(r,e)=>{let t;switch(r.code){case d.invalid_type:r.received===f.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case d.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,b.jsonStringifyReplacer)}`;break;case d.unrecognized_keys:t=`Unrecognized key(s) in object: ${b.joinValues(r.keys,", ")}`;break;case d.invalid_union:t="Invalid input";break;case d.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${b.joinValues(r.options)}`;break;case d.invalid_enum_value:t=`Invalid enum value. Expected ${b.joinValues(r.options)}, received '${r.received}'`;break;case d.invalid_arguments:t="Invalid function arguments";break;case d.invalid_return_type:t="Invalid function return type";break;case d.invalid_date:t="Invalid date";break;case d.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:b.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case d.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case d.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case d.custom:t="Invalid input";break;case d.invalid_intersection_types:t="Intersection results could not be merged";break;case d.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case d.not_finite:t="Number must be finite";break;default:t=e.defaultError,b.assertNever(r)}return{message:t}};let dt=ee;function sr(r){dt=r}function Ee(){return dt}const Ie=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const l=n.filter(u=>!!u).slice().reverse();for(const u of l)o=u(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},ar=[];function h(r,e){const t=Ee(),n=Ie({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===ee?void 0:ee].filter(s=>!!s)});r.common.issues.push(n)}class C{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return g;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const a=await s.key,i=await s.value;n.push({key:a,value:i})}return C.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return g;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}}const g=Object.freeze({status:"aborted"}),Q=r=>({status:"dirty",value:r}),R=r=>({status:"valid",value:r}),Ve=r=>r.status==="aborted",He=r=>r.status==="dirty",ie=r=>r.status==="valid",oe=r=>typeof Promise<"u"&&r instanceof Promise;function Se(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function ut(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var m;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(m||(m={}));var se,ae;class ${constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ke=(r,e)=>{if(ie(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new N(r.common.issues);return this._error=t,this._error}}};function v(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{var l,u;const{message:c}=r;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(l=c??n)!==null&&l!==void 0?l:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(u=c??t)!==null&&u!==void 0?u:o.defaultError}},description:s}}class _{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return V(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:V(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new C,ctx:{common:e.parent.common,data:e.data,parsedType:V(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(oe(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const s={common:{issues:[],async:(n=t?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:V(e)},a=this._parseSync({data:e,path:s.path,parent:s});return Ke(s,a)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:V(e)},s=this._parse({data:e,path:n.path,parent:n}),a=await(oe(s)?s:Promise.resolve(s));return Ke(n,a)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:d.custom,...n(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new Z({schema:this,typeName:p.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return j.create(this,this._def)}nullable(){return W.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return M.create(this,this._def)}promise(){return re.create(this,this._def)}or(e){return le.create([this,e],this._def)}and(e){return he.create(this,e,this._def)}transform(e){return new Z({...v(this._def),schema:this,typeName:p.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new ye({...v(this._def),innerType:this,defaultValue:t,typeName:p.ZodDefault})}brand(){return new Ge({typeName:p.ZodBranded,type:this,...v(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new ve({...v(this._def),innerType:this,catchValue:t,typeName:p.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return we.create(this,e)}readonly(){return _e.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const ir=/^c[^\s-]{8,}$/i,or=/^[0-9a-z]+$/,cr=/^[0-9A-HJKMNP-TV-Z]{26}$/,dr=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ur=/^[a-z0-9_-]{21}$/i,lr=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,hr=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,fr="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let je;const mr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,pr=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,gr=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,lt="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",yr=new RegExp(`^${lt}$`);function ht(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function vr(r){return new RegExp(`^${ht(r)}$`)}function ft(r){let e=`${lt}T${ht(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function _r(r,e){return!!((e==="v4"||!e)&&mr.test(r)||(e==="v6"||!e)&&pr.test(r))}class L extends _{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==f.string){const a=this._getOrReturnCtx(e);return h(a,{code:d.invalid_type,expected:f.string,received:a.parsedType}),g}const n=new C;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:d.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:d.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?h(s,{code:d.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&h(s,{code:d.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")hr.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"email",code:d.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")je||(je=new RegExp(fr,"u")),je.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"emoji",code:d.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")dr.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"uuid",code:d.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")ur.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"nanoid",code:d.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")ir.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"cuid",code:d.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")or.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"cuid2",code:d.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")cr.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"ulid",code:d.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),h(s,{validation:"url",code:d.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"regex",code:d.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),h(s,{code:d.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),h(s,{code:d.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),h(s,{code:d.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ft(a).test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:d.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?yr.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:d.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?vr(a).test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:d.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?lr.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"duration",code:d.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?_r(e.data,a.version)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"ip",code:d.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?gr.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"base64",code:d.invalid_string,message:a.message}),n.dirty()):b.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:d.invalid_string,...m.errToObj(n)})}_addCheck(e){return new L({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...m.errToObj(e)})}url(e){return this._addCheck({kind:"url",...m.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...m.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...m.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...m.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...m.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...m.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...m.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...m.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...m.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...m.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...m.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...m.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...m.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...m.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...m.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...m.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...m.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...m.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...m.errToObj(t)})}nonempty(e){return this.min(1,m.errToObj(e))}trim(){return new L({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new L({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new L({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}L.create=r=>{var e;return new L({checks:[],typeName:p.ZodString,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...v(r)})};function wr(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,a=parseInt(r.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return a%i/Math.pow(10,s)}class H extends _{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==f.number){const a=this._getOrReturnCtx(e);return h(a,{code:d.invalid_type,expected:f.number,received:a.parsedType}),g}let n;const s=new C;for(const a of this._def.checks)a.kind==="int"?b.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{code:d.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),h(n,{code:d.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),h(n,{code:d.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?wr(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),h(n,{code:d.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{code:d.not_finite,message:a.message}),s.dirty()):b.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,m.toString(t))}gt(e,t){return this.setLimit("min",e,!1,m.toString(t))}lte(e,t){return this.setLimit("max",e,!0,m.toString(t))}lt(e,t){return this.setLimit("max",e,!1,m.toString(t))}setLimit(e,t,n,s){return new H({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:m.toString(s)}]})}_addCheck(e){return new H({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:m.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:m.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:m.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:m.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:m.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:m.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:m.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:m.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:m.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&b.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}H.create=r=>new H({checks:[],typeName:p.ZodNumber,coerce:r?.coerce||!1,...v(r)});class B extends _{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==f.bigint){const a=this._getOrReturnCtx(e);return h(a,{code:d.invalid_type,expected:f.bigint,received:a.parsedType}),g}let n;const s=new C;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),h(n,{code:d.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),h(n,{code:d.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),h(n,{code:d.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):b.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,m.toString(t))}gt(e,t){return this.setLimit("min",e,!1,m.toString(t))}lte(e,t){return this.setLimit("max",e,!0,m.toString(t))}lt(e,t){return this.setLimit("max",e,!1,m.toString(t))}setLimit(e,t,n,s){return new B({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:m.toString(s)}]})}_addCheck(e){return new B({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:m.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:m.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:m.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:m.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:m.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}B.create=r=>{var e;return new B({checks:[],typeName:p.ZodBigInt,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...v(r)})};class ce extends _{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==f.boolean){const n=this._getOrReturnCtx(e);return h(n,{code:d.invalid_type,expected:f.boolean,received:n.parsedType}),g}return R(e.data)}}ce.create=r=>new ce({typeName:p.ZodBoolean,coerce:r?.coerce||!1,...v(r)});class Y extends _{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==f.date){const a=this._getOrReturnCtx(e);return h(a,{code:d.invalid_type,expected:f.date,received:a.parsedType}),g}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return h(a,{code:d.invalid_date}),g}const n=new C;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:d.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:d.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):b.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Y({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:m.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:m.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Y.create=r=>new Y({checks:[],coerce:r?.coerce||!1,typeName:p.ZodDate,...v(r)});class Ce extends _{_parse(e){if(this._getType(e)!==f.symbol){const n=this._getOrReturnCtx(e);return h(n,{code:d.invalid_type,expected:f.symbol,received:n.parsedType}),g}return R(e.data)}}Ce.create=r=>new Ce({typeName:p.ZodSymbol,...v(r)});class de extends _{_parse(e){if(this._getType(e)!==f.undefined){const n=this._getOrReturnCtx(e);return h(n,{code:d.invalid_type,expected:f.undefined,received:n.parsedType}),g}return R(e.data)}}de.create=r=>new de({typeName:p.ZodUndefined,...v(r)});class ue extends _{_parse(e){if(this._getType(e)!==f.null){const n=this._getOrReturnCtx(e);return h(n,{code:d.invalid_type,expected:f.null,received:n.parsedType}),g}return R(e.data)}}ue.create=r=>new ue({typeName:p.ZodNull,...v(r)});class te extends _{constructor(){super(...arguments),this._any=!0}_parse(e){return R(e.data)}}te.create=r=>new te({typeName:p.ZodAny,...v(r)});class G extends _{constructor(){super(...arguments),this._unknown=!0}_parse(e){return R(e.data)}}G.create=r=>new G({typeName:p.ZodUnknown,...v(r)});class F extends _{_parse(e){const t=this._getOrReturnCtx(e);return h(t,{code:d.invalid_type,expected:f.never,received:t.parsedType}),g}}F.create=r=>new F({typeName:p.ZodNever,...v(r)});class Re extends _{_parse(e){if(this._getType(e)!==f.undefined){const n=this._getOrReturnCtx(e);return h(n,{code:d.invalid_type,expected:f.void,received:n.parsedType}),g}return R(e.data)}}Re.create=r=>new Re({typeName:p.ZodVoid,...v(r)});class M extends _{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==f.array)return h(t,{code:d.invalid_type,expected:f.array,received:t.parsedType}),g;if(s.exactLength!==null){const i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(h(t,{code:i?d.too_big:d.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(h(t,{code:d.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(h(t,{code:d.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new $(t,i,t.path,o)))).then(i=>C.mergeArray(n,i));const a=[...t.data].map((i,o)=>s.type._parseSync(new $(t,i,t.path,o)));return C.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new M({...this._def,minLength:{value:e,message:m.toString(t)}})}max(e,t){return new M({...this._def,maxLength:{value:e,message:m.toString(t)}})}length(e,t){return new M({...this._def,exactLength:{value:e,message:m.toString(t)}})}nonempty(e){return this.min(1,e)}}M.create=(r,e)=>new M({type:r,minLength:null,maxLength:null,exactLength:null,typeName:p.ZodArray,...v(e)});function K(r){if(r instanceof T){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=j.create(K(n))}return new T({...r._def,shape:()=>e})}else return r instanceof M?new M({...r._def,type:K(r.element)}):r instanceof j?j.create(K(r.unwrap())):r instanceof W?W.create(K(r.unwrap())):r instanceof U?U.create(r.items.map(e=>K(e))):r}class T extends _{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=b.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==f.object){const u=this._getOrReturnCtx(e);return h(u,{code:d.invalid_type,expected:f.object,received:u.parsedType}),g}const{status:n,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof F&&this._def.unknownKeys==="strip"))for(const u in s.data)i.includes(u)||o.push(u);const l=[];for(const u of i){const c=a[u],y=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new $(s,y,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof F){const u=this._def.unknownKeys;if(u==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(u==="strict")o.length>0&&(h(s,{code:d.unrecognized_keys,keys:o}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const c of o){const y=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new $(s,y,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const c of l){const y=await c.key,k=await c.value;u.push({key:y,value:k,alwaysSet:c.alwaysSet})}return u}).then(u=>C.mergeObjectSync(n,u)):C.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return m.errToObj,new T({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,a,i,o;const l=(i=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,t,n).message)!==null&&i!==void 0?i:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=m.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new T({...this._def,unknownKeys:"strip"})}passthrough(){return new T({...this._def,unknownKeys:"passthrough"})}extend(e){return new T({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new T({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:p.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new T({...this._def,catchall:e})}pick(e){const t={};return b.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new T({...this._def,shape:()=>t})}omit(e){const t={};return b.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new T({...this._def,shape:()=>t})}deepPartial(){return K(this)}partial(e){const t={};return b.objectKeys(this.shape).forEach(n=>{const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new T({...this._def,shape:()=>t})}required(e){const t={};return b.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof j;)a=a._def.innerType;t[n]=a}}),new T({...this._def,shape:()=>t})}keyof(){return mt(b.objectKeys(this.shape))}}T.create=(r,e)=>new T({shape:()=>r,unknownKeys:"strip",catchall:F.create(),typeName:p.ZodObject,...v(e)});T.strictCreate=(r,e)=>new T({shape:()=>r,unknownKeys:"strict",catchall:F.create(),typeName:p.ZodObject,...v(e)});T.lazycreate=(r,e)=>new T({shape:r,unknownKeys:"strip",catchall:F.create(),typeName:p.ZodObject,...v(e)});class le extends _{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new N(o.ctx.common.issues));return h(t,{code:d.invalid_union,unionErrors:i}),g}if(t.common.async)return Promise.all(n.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const l of n){const u={...t,common:{...t.common,issues:[]},parent:null},c=l._parseSync({data:t.data,path:t.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(l=>new N(l));return h(t,{code:d.invalid_union,unionErrors:o}),g}}get options(){return this._def.options}}le.create=(r,e)=>new le({options:r,typeName:p.ZodUnion,...v(e)});const D=r=>r instanceof me?D(r.schema):r instanceof Z?D(r.innerType()):r instanceof pe?[r.value]:r instanceof z?r.options:r instanceof ge?b.objectValues(r.enum):r instanceof ye?D(r._def.innerType):r instanceof de?[void 0]:r instanceof ue?[null]:r instanceof j?[void 0,...D(r.unwrap())]:r instanceof W?[null,...D(r.unwrap())]:r instanceof Ge||r instanceof _e?D(r.unwrap()):r instanceof ve?D(r._def.innerType):[];class Me extends _{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==f.object)return h(t,{code:d.invalid_type,expected:f.object,received:t.parsedType}),g;const n=this.discriminator,s=t.data[n],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:d.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),g)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const a of t){const i=D(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new Me({typeName:p.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...v(n)})}}function Be(r,e){const t=V(r),n=V(e);if(r===e)return{valid:!0,data:r};if(t===f.object&&n===f.object){const s=b.objectKeys(e),a=b.objectKeys(r).filter(o=>s.indexOf(o)!==-1),i={...r,...e};for(const o of a){const l=Be(r[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(t===f.array&&n===f.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],l=Be(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===f.date&&n===f.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class he extends _{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(a,i)=>{if(Ve(a)||Ve(i))return g;const o=Be(a.value,i.value);return o.valid?((He(a)||He(i))&&t.dirty(),{status:t.value,value:o.data}):(h(n,{code:d.invalid_intersection_types}),g)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}he.create=(r,e,t)=>new he({left:r,right:e,typeName:p.ZodIntersection,...v(t)});class U extends _{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==f.array)return h(n,{code:d.invalid_type,expected:f.array,received:n.parsedType}),g;if(n.data.length<this._def.items.length)return h(n,{code:d.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g;!this._def.rest&&n.data.length>this._def.items.length&&(h(n,{code:d.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((i,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new $(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(a).then(i=>C.mergeArray(t,i)):C.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new U({...this._def,rest:e})}}U.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new U({items:r,typeName:p.ZodTuple,rest:null,...v(e)})};class fe extends _{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==f.object)return h(n,{code:d.invalid_type,expected:f.object,received:n.parsedType}),g;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in n.data)s.push({key:a._parse(new $(n,o,n.path,o)),value:i._parse(new $(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?C.mergeObjectAsync(t,s):C.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof _?new fe({keyType:e,valueType:t,typeName:p.ZodRecord,...v(n)}):new fe({keyType:L.create(),valueType:e,typeName:p.ZodRecord,...v(t)})}}class Oe extends _{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==f.map)return h(n,{code:d.invalid_type,expected:f.map,received:n.parsedType}),g;const s=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map(([o,l],u)=>({key:s._parse(new $(n,o,n.path,[u,"key"])),value:a._parse(new $(n,l,n.path,[u,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of i){const u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return g;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of i){const u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return g;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}}}}Oe.create=(r,e,t)=>new Oe({valueType:e,keyType:r,typeName:p.ZodMap,...v(t)});class J extends _{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==f.set)return h(n,{code:d.invalid_type,expected:f.set,received:n.parsedType}),g;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(h(n,{code:d.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(h(n,{code:d.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const a=this._def.valueType;function i(l){const u=new Set;for(const c of l){if(c.status==="aborted")return g;c.status==="dirty"&&t.dirty(),u.add(c.value)}return{status:t.value,value:u}}const o=[...n.data.values()].map((l,u)=>a._parse(new $(n,l,n.path,u)));return n.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,t){return new J({...this._def,minSize:{value:e,message:m.toString(t)}})}max(e,t){return new J({...this._def,maxSize:{value:e,message:m.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}J.create=(r,e)=>new J({valueType:r,minSize:null,maxSize:null,typeName:p.ZodSet,...v(e)});class X extends _{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==f.function)return h(t,{code:d.invalid_type,expected:f.function,received:t.parsedType}),g;function n(o,l){return Ie({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ee(),ee].filter(u=>!!u),issueData:{code:d.invalid_arguments,argumentsError:l}})}function s(o,l){return Ie({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ee(),ee].filter(u=>!!u),issueData:{code:d.invalid_return_type,returnTypeError:l}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof re){const o=this;return R(async function(...l){const u=new N([]),c=await o._def.args.parseAsync(l,a).catch(E=>{throw u.addIssue(n(l,E)),u}),y=await Reflect.apply(i,this,c);return await o._def.returns._def.type.parseAsync(y,a).catch(E=>{throw u.addIssue(s(y,E)),u})})}else{const o=this;return R(function(...l){const u=o._def.args.safeParse(l,a);if(!u.success)throw new N([n(l,u.error)]);const c=Reflect.apply(i,this,u.data),y=o._def.returns.safeParse(c,a);if(!y.success)throw new N([s(c,y.error)]);return y.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new X({...this._def,args:U.create(e).rest(G.create())})}returns(e){return new X({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new X({args:e||U.create([]).rest(G.create()),returns:t||G.create(),typeName:p.ZodFunction,...v(n)})}}class me extends _{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}me.create=(r,e)=>new me({getter:r,typeName:p.ZodLazy,...v(e)});class pe extends _{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:d.invalid_literal,expected:this._def.value}),g}return{status:"valid",value:e.data}}get value(){return this._def.value}}pe.create=(r,e)=>new pe({value:r,typeName:p.ZodLiteral,...v(e)});function mt(r,e){return new z({values:r,typeName:p.ZodEnum,...v(e)})}class z extends _{constructor(){super(...arguments),se.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return h(t,{expected:b.joinValues(n),received:t.parsedType,code:d.invalid_type}),g}if(Se(this,se)||ut(this,se,new Set(this._def.values)),!Se(this,se).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return h(t,{received:t.data,code:d.invalid_enum_value,options:n}),g}return R(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return z.create(e,{...this._def,...t})}exclude(e,t=this._def){return z.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}se=new WeakMap;z.create=mt;class ge extends _{constructor(){super(...arguments),ae.set(this,void 0)}_parse(e){const t=b.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==f.string&&n.parsedType!==f.number){const s=b.objectValues(t);return h(n,{expected:b.joinValues(s),received:n.parsedType,code:d.invalid_type}),g}if(Se(this,ae)||ut(this,ae,new Set(b.getValidEnumValues(this._def.values))),!Se(this,ae).has(e.data)){const s=b.objectValues(t);return h(n,{received:n.data,code:d.invalid_enum_value,options:s}),g}return R(e.data)}get enum(){return this._def.values}}ae=new WeakMap;ge.create=(r,e)=>new ge({values:r,typeName:p.ZodNativeEnum,...v(e)});class re extends _{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==f.promise&&t.common.async===!1)return h(t,{code:d.invalid_type,expected:f.promise,received:t.parsedType}),g;const n=t.parsedType===f.promise?t.data:Promise.resolve(t.data);return R(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}re.create=(r,e)=>new re({type:r,typeName:p.ZodPromise,...v(e)});class Z extends _{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===p.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{h(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(n.data,a);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return g;const l=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return l.status==="aborted"?g:l.status==="dirty"||t.value==="dirty"?Q(l.value):l});{if(t.value==="aborted")return g;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?g:o.status==="dirty"||t.value==="dirty"?Q(o.value):o}}if(s.type==="refinement"){const i=o=>{const l=s.refinement(o,a);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?g:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?g:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!ie(i))return i;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>ie(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):i);b.assertNever(s)}}Z.create=(r,e,t)=>new Z({schema:r,typeName:p.ZodEffects,effect:e,...v(t)});Z.createWithPreprocess=(r,e,t)=>new Z({schema:e,effect:{type:"preprocess",transform:r},typeName:p.ZodEffects,...v(t)});class j extends _{_parse(e){return this._getType(e)===f.undefined?R(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}j.create=(r,e)=>new j({innerType:r,typeName:p.ZodOptional,...v(e)});class W extends _{_parse(e){return this._getType(e)===f.null?R(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}W.create=(r,e)=>new W({innerType:r,typeName:p.ZodNullable,...v(e)});class ye extends _{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===f.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ye.create=(r,e)=>new ye({innerType:r,typeName:p.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...v(e)});class ve extends _{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return oe(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new N(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new N(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}ve.create=(r,e)=>new ve({innerType:r,typeName:p.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...v(e)});class Ne extends _{_parse(e){if(this._getType(e)!==f.nan){const n=this._getOrReturnCtx(e);return h(n,{code:d.invalid_type,expected:f.nan,received:n.parsedType}),g}return{status:"valid",value:e.data}}}Ne.create=r=>new Ne({typeName:p.ZodNaN,...v(r)});const br=Symbol("zod_brand");class Ge extends _{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class we extends _{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?g:a.status==="dirty"?(t.dirty(),Q(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?g:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new we({in:e,out:t,typeName:p.ZodPipeline})}}class _e extends _{_parse(e){const t=this._def.innerType._parse(e),n=s=>(ie(s)&&(s.value=Object.freeze(s.value)),s);return oe(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}_e.create=(r,e)=>new _e({innerType:r,typeName:p.ZodReadonly,...v(e)});function pt(r,e={},t){return r?te.create().superRefine((n,s)=>{var a,i;if(!r(n)){const o=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,l=(i=(a=o.fatal)!==null&&a!==void 0?a:t)!==null&&i!==void 0?i:!0,u=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...u,fatal:l})}}):te.create()}const xr={object:T.lazycreate};var p;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(p||(p={}));const kr=(r,e={message:`Input not instance of ${r.name}`})=>pt(t=>t instanceof r,e),gt=L.create,yt=H.create,Tr=Ne.create,Er=B.create,vt=ce.create,Ir=Y.create,Sr=Ce.create,Cr=de.create,Rr=ue.create,Or=te.create,Nr=G.create,Ar=F.create,Lr=Re.create,Mr=M.create,Zr=T.create,Pr=T.strictCreate,jr=le.create,$r=Me.create,Ur=he.create,Dr=U.create,Fr=fe.create,Vr=Oe.create,Hr=J.create,Br=X.create,zr=me.create,Wr=pe.create,Gr=z.create,Yr=ge.create,Jr=re.create,Qe=Z.create,qr=j.create,Kr=W.create,Qr=Z.createWithPreprocess,Xr=we.create,en=()=>gt().optional(),tn=()=>yt().optional(),rn=()=>vt().optional(),nn={string:(r=>L.create({...r,coerce:!0})),number:(r=>H.create({...r,coerce:!0})),boolean:(r=>ce.create({...r,coerce:!0})),bigint:(r=>B.create({...r,coerce:!0})),date:(r=>Y.create({...r,coerce:!0}))},sn=g;var x=Object.freeze({__proto__:null,defaultErrorMap:ee,setErrorMap:sr,getErrorMap:Ee,makeIssue:Ie,EMPTY_PATH:ar,addIssueToContext:h,ParseStatus:C,INVALID:g,DIRTY:Q,OK:R,isAborted:Ve,isDirty:He,isValid:ie,isAsync:oe,get util(){return b},get objectUtil(){return Fe},ZodParsedType:f,getParsedType:V,ZodType:_,datetimeRegex:ft,ZodString:L,ZodNumber:H,ZodBigInt:B,ZodBoolean:ce,ZodDate:Y,ZodSymbol:Ce,ZodUndefined:de,ZodNull:ue,ZodAny:te,ZodUnknown:G,ZodNever:F,ZodVoid:Re,ZodArray:M,ZodObject:T,ZodUnion:le,ZodDiscriminatedUnion:Me,ZodIntersection:he,ZodTuple:U,ZodRecord:fe,ZodMap:Oe,ZodSet:J,ZodFunction:X,ZodLazy:me,ZodLiteral:pe,ZodEnum:z,ZodNativeEnum:ge,ZodPromise:re,ZodEffects:Z,ZodTransformer:Z,ZodOptional:j,ZodNullable:W,ZodDefault:ye,ZodCatch:ve,ZodNaN:Ne,BRAND:br,ZodBranded:Ge,ZodPipeline:we,ZodReadonly:_e,custom:pt,Schema:_,ZodSchema:_,late:xr,get ZodFirstPartyTypeKind(){return p},coerce:nn,any:Or,array:Mr,bigint:Er,boolean:vt,date:Ir,discriminatedUnion:$r,effect:Qe,enum:Gr,function:Br,instanceof:kr,intersection:Ur,lazy:zr,literal:Wr,map:Vr,nan:Tr,nativeEnum:Yr,never:Ar,null:Rr,nullable:Kr,number:yt,object:Zr,oboolean:rn,onumber:tn,optional:qr,ostring:en,pipeline:Xr,preprocess:Qr,promise:Jr,record:Fr,set:Hr,strictObject:Pr,string:gt,symbol:Sr,transformer:Qe,tuple:Dr,undefined:Cr,union:jr,unknown:Nr,void:Lr,NEVER:sn,ZodIssueCode:d,quotelessJson:nr,ZodError:N});function an(r){return fn.safeParse(r).success}const _t=x.object({portId:x.string()}),on=x.object({type:x.enum(["SEND_TO_CURRENT_FRAME","SEND_TO_PARENT_FRAME"]),data:x.unknown(),replyPort:_t.optional()}),cn=x.object({type:x.literal("SEND_TO_CHILD_FRAME"),data:x.unknown(),targetFrame:x.object({src:x.string()}),replyPort:_t.optional()}),dn=x.object({type:x.literal("SEND_TO_PORT"),data:x.unknown(),target:x.object({portId:x.string()})}),un=x.object({type:x.literal("REGISTER_PORT"),portId:x.string()}).strict(),ln=x.object({type:x.literal("PORT_STARTED"),portId:x.string()}).strict(),hn=x.object({type:x.literal("PORT_CLOSED"),portId:x.string()}).strict(),fn=x.union([on,cn,dn,un,ln,hn]);class be extends Error{constructor(e){super(`Error while relaying message: ${e}`)}}class Xe extends be{constructor(e){super(`The sender is missing one or more of the following properties: ${e.join(", ")}`)}}class ne extends be{constructor(e){super(`Failed to send message to target frame: ${e}`)}}class mn extends be{constructor(){super("webNavigation.getAllFrames returned null, expected list of frames")}}class et extends be{constructor(e,t,n){super(`Could not find target frame with ${e} = (${t}) in list of frames (found frames: ${JSON.stringify(n.map(s=>s.url))})`)}}class tt extends be{constructor(e){super(`Cannot find port with id (${e}). The port might not be registered yet or has been closed`)}}class Ae{constructor(){this.map=new Map}static async loadFromStorage(){const e=new Ae;return await e.restore(),e}async addFrame(e,t,n){this.map.has(e)||this.map.set(e,new Map),this.map.get(e)?.set(n,t),await this.persist()}async removeTab(e){this.map.delete(e),await this.persist()}async getFrameId(e,t){return this.map.get(e)?.get(t)}async getFrameUrls(e){return Array.from(this.map.get(e)?.keys()??[])}async persist(){const e={};for(const[t,n]of this.map)e[t]=Object.fromEntries(n.entries());await A.setItem("local:frameCollection",e)}async restore(){const e=await A.getItem("local:frameCollection");if(e==null)return;const t=x.record(x.coerce.number(),x.record(x.string(),x.number())),{success:n,data:s}=t.safeParse(e);if(!n)throw new Error("Failed to parse frame collection from storage");for(const[a,i]of Object.entries(s))this.map.set(Number(a),new Map(Object.entries(i).map(([o,l])=>[o,l])))}}class pn{constructor(){this.initListeners(),this.collection=Ae.loadFromStorage().catch(e=>(w.error(e,"Failed to initialize FrameSrcTracker FrameCollection:"),new Ae))}initListeners(){P.webNavigation.onBeforeNavigate.addListener(e=>{this.collection.then(t=>{t.addFrame(e.tabId,e.frameId,e.url).catch(n=>{w.error(n,"Failed to add frame to FrameSrcTracker:")})})}),P.tabs.onRemoved.addListener(e=>{this.collection.then(t=>{t.removeTab(e).catch(n=>{w.error(n,"Failed to remove tab from FrameSrcTracker:")})})})}async findFrameId(e,t){return(await this.collection).getFrameId(e,t)}async getFrameUrls(e){return(await this.collection).getFrameUrls(e)}}class gn{constructor(){this.frameSrcTracker=new pn,this.portRegistry=new Map,this.startedPorts=new Set,this.unstartedMessageQueues=new Map,this.initMessageRouting()}initMessageRouting(){P.runtime.onMessage.addListener((e,t,n)=>{if(!(!yn(t)||!an(e)))return(async()=>{try{switch(e.type){case"SEND_TO_PARENT_FRAME":await this.sendToParentFrame(e,t);break;case"SEND_TO_CHILD_FRAME":await this.sendToChildFrame(e,t);break;case"SEND_TO_CURRENT_FRAME":await this.sendToSameFrame(e,t);break;case"SEND_TO_PORT":await this.sendToPort(e,t);break;case"REGISTER_PORT":await this.registerPort(e,t);break;case"PORT_STARTED":await this.handlePortStart(e,t);break;case"PORT_CLOSED":await this.handlePortClose(e,t);break}n({success:!0})}catch(s){n({success:!1,error:s.message})}})(),!0})}async sendToParentFrame(e,t){this.validateSender(t);const n=await P.webNavigation.getAllFrames({tabId:t.tab.id});if(!n)throw new mn;const s=n.find(i=>i.frameId===t.frameId);if(s==null)throw new et("id",t.frameId,n);if(s.parentFrameId===-1)return;const a={data:e.data,replyPort:e.replyPort?{portId:e.replyPort.portId}:void 0};try{await P.tabs.sendMessage(t.tab.id,a,{frameId:s.parentFrameId})}catch(i){if(i.message.includes("Receiving end does not exist"))return;throw new ne(i.message)}}async sendToChildFrame(e,t){this.validateSender(t);const n={data:e.data,replyPort:e.replyPort?{portId:e.replyPort.portId}:void 0},s=await this.frameSrcTracker.findFrameId(t.tab.id,e.targetFrame.src);if(s==null){const a=await this.frameSrcTracker.getFrameUrls(t.tab.id);throw new et("src",e.targetFrame.src,a?.map(i=>({url:i}))??[])}if(s===t.frameId)throw new ne("A frame attempted to send a message to a child frame but would send it to itself. Send message aborted.");try{await P.tabs.sendMessage(t.tab.id,n,{frameId:s})}catch(a){if(a.message.includes("Receiving end does not exist"))return;throw new ne(a.message)}}async sendToSameFrame(e,t){this.validateSender(t);const n={data:e.data,replyPort:e.replyPort?{portId:e.replyPort.portId}:void 0};try{await P.tabs.sendMessage(t.tab.id,n,{frameId:t.frameId})}catch(s){throw new ne(s.message)}}async sendToPort(e,t){this.validateSender(t);const n={data:e.data,target:{portId:e.target.portId}};if(!this.startedPorts.has(e.target.portId)){this.unstartedMessageQueues.set(e.target.portId,(this.unstartedMessageQueues.get(e.target.portId)??[]).concat([n]));return}try{const s=this.portRegistry.get(e.target.portId);if(s==null)throw new tt(e.target.portId);await P.tabs.sendMessage(t.tab.id,n,{frameId:s})}catch(s){throw new ne(s.message)}}async registerPort(e,t){this.validateSender(t),this.portRegistry.set(e.portId,t.frameId)}async handlePortStart(e,t){this.validateSender(t);const n=t.tab.id;this.startedPorts.add(e.portId);const s=this.portRegistry.get(e.portId);if(s==null)throw new tt(e.portId);this.unstartedMessageQueues.get(e.portId)?.forEach(a=>{P.tabs.sendMessage(n,a,{frameId:s}).catch(i=>{w.error(`Failed to send queued message to port ${e.portId}: ${i.message}`)})}),this.unstartedMessageQueues.delete(e.portId)}async handlePortClose(e,t){this.validateSender(t),this.startedPorts.delete(e.portId),this.portRegistry.delete(e.portId),this.unstartedMessageQueues.delete(e.portId)}validateSender(e){if(e.tab?.id==null)throw new Xe(["tab.id"]);if(e.frameId==null)throw new Xe(["frameId"])}}function yn(r){return r.id===P.runtime.id}const vn=It({persistent:!1,type:"module",main(){St(),I.runtime.onInstalled.addListener(r),new gn;function r(){const c=I.contextMenus.create({id:"lemon-learning",title:"Lemon Learning"});I.contextMenus.create({id:"force-logout",title:"Force logout (use carefully)",parentId:c})}I.contextMenus.onClicked.addListener(c=>{c.menuItemId==="force-logout"&&e()});function e(){I.storage.sync.clear(),I.storage.local.clear()}I.webNavigation.onDOMContentLoaded.addListener(c=>{l(c)}),I.runtime.onMessage.addListener(function(c,y,k){if(y.id===I.runtime.id&&!(typeof c!="object"||c===null)&&!(!("action"in c)||typeof c.action!="string"))switch(c.action){case"EXECUTE_LL_CROSS":return n(c,y);case"SHOULD_LAUNCH_LL_CROSS":return s(c,y,k);case"BACKGROUND_FETCH":return a(c,y,k);case"BACKGROUND_FETCH_V2":return i(c,y,k);case"QUERY_CURRENT_TAB":return o(c,y,k)}}),I.runtime.onConnect.addListener(function(c){c.name==="BACKGROUND_FETCH_STREAM"&&t(c)});function t(c){c.onMessage.addListener(y=>{y.action==="START_STREAM"&&(async()=>{const{url:k,options:E}=y.data;try{const S=await fetch(k,E);if(!S.ok){c.postMessage({error:`HTTP Error: ${S.status}`});return}if(!S.body){c.postMessage({error:"No response body received"});return}const O=S.body.getReader();let q=await O.read();for(;!q.done;){const{value:Ze}=q;c.postMessage({chunk:Array.from(Ze)}),q=await O.read()}c.postMessage({done:!0})}catch(S){c.postMessage({error:S??"Network error"})}})()})}function n(c,y,k){const E=y.tab?.id;E!==void 0&&I.tabs.sendMessage(E,{action:"EXECUTE_LL_LAUNCH_CROSS"})}function s(c,y,k){const E=y.tab?.id;if(E!==void 0)return I.tabs.sendMessage(E,{action:"SHOULD_LAUNCH_LL_CROSS"}).then(S=>{k(S)}),!0}function a(c,y,k){const{url:E,requestInit:S}=c.data;return fetch(E,S).then(async O=>O.clone().json().catch(async()=>O.text())).then(k).catch(k),!0}function i(c,y,k){const{url:E,options:S}=c.data;return fetch(E,S).then(async O=>{const q={};for(const[Ze,wt]of O.headers.entries())q[Ze]=wt;k({body:await O.clone().json().catch(async()=>O.text()),status:O.status,statusText:O.statusText,headers:q})}).catch(O=>{k({error:O.message,type:typeof O})}),!0}function o(c,y,k){return y.tab===void 0?(k({error:"Failed to get the sender tab info"}),!0):(k({id:y.tab.id}),!0)}async function l(c){const y=await I.tabs.get(c.tabId);if(y.url===void 0||y.url.startsWith("about:")||y.url.startsWith("chrome:")){w.debug("Tab has not a valid URL, skipping injecting content script",{tabUrl:y.url});return}u(y.url).then(E=>{if(!E){w.debug("Lemon Learning should not be included for this host, skipping injecting content scripts",{tabUrl:y.url});return}k(c.frameId)?Promise.all([I.scripting.executeScript({target:{tabId:c.tabId,frameIds:[c.frameId]},files:["content-scripts/content.js"]}),I.scripting.insertCSS({target:{tabId:c.tabId,frameIds:[c.frameId]},files:["content-scripts/content.css"]})]).then(()=>{w.debug("Content script injected",{tabUrl:y.url})}).catch(S=>{w.error(S,"Error while injecting content script",{tabUrl:y.url,frameId:c.frameId})}):Promise.all([I.scripting.executeScript({target:{tabId:c.tabId,frameIds:[c.frameId]},files:["content-scripts/cross.js"]}),I.scripting.insertCSS({target:{tabId:c.tabId,frameIds:[c.frameId]},files:["content-scripts/cross.css"]})]).then(()=>{w.debug("Cross content script injected",{tabUrl:y.url,frameId:c.frameId})}).catch(S=>{w.error(S,"Error while injecting cross content script",{tabUrl:y.url,frameId:c.frameId})})});function k(E){return E===0}}async function u(c){return await Mt()?!1:new rr({currentHost:c,hosts:await tr(),ignorePathOnIncluded:!0}).isRespected()}}});function xe(r,...e){}const _n={debug:(...r)=>xe(console.debug,...r),log:(...r)=>xe(console.log,...r),warn:(...r)=>xe(console.warn,...r),error:(...r)=>xe(console.error,...r)};let rt;try{xt(),rt=vn.main(),rt instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw _n.error("The background crashed on startup!"),r}
